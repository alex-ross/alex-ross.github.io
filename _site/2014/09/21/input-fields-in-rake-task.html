<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="author" href="/humans.txt">

    
      <title>Input fields in rake task - aross.se</title>
      <meta name="description" content="Rake is an awesome tool to automate workflows during development or for some other stuff.
" />
    

    <link href='//fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="/css/style.css">

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  </head>
  <body>
    <header>
      <!-- Top banner -->
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-4141599655973760"
           data-ad-slot="7238016739"
           data-ad-format="auto"></ins>
      <a href="/" title="aross.se" class="title">
        <span class="logo"></span>
        <span class="text">aross.se</span>
      </a>
      <p class="muted">Happy developer which loves to play around with Ruby, JavaScript and other stuff thats related to mobile and web development</p>
    </header>

    <main>
  <article>
    <h1>Input fields in rake task</h1>
    <small class="muted">21 September 2014</small>

    <p>Rake is an awesome tool to automate workflows during development or for some other stuff.</p>

<p>But lets say we have a task called <code>customer:add</code> where we want to assign name
and email to the new customer. In this case we must be able to interact with
our task.</p>

<p>So we have this rake file as you can se below which just adds an new customer to
an YAML file but they all will have the same name and email until we manually
changes the file. Lets take a look how we could assign then while running the
taks in next section.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="c1"># Rakefile</span>
<span class="nb">require</span> <span class="s2">&quot;yaml&quot;</span>

<span class="n">namespace</span> <span class="ss">:customer</span> <span class="k">do</span>
  <span class="n">task</span> <span class="ss">:add</span> <span class="k">do</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="s2">&quot;Example name&quot;</span>
    <span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;Example email&quot;</span>

    <span class="c1"># TODO: Here we need to customize the attributes</span>

    <span class="n">storage</span> <span class="o">=</span> <span class="s1">&#39;customers.yml&#39;</span>
    <span class="n">yaml</span> <span class="o">=</span> <span class="n">load_yaml_storage</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>
    <span class="n">yaml</span><span class="o">[</span><span class="s2">&quot;customers&quot;</span><span class="o">]</span> <span class="o">||=</span> <span class="o">[]</span> <span class="c1"># Make sure the key customer is defined</span>
    <span class="n">yaml</span><span class="o">[</span><span class="s2">&quot;customers&quot;</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="p">{</span> <span class="c1"># Adds the new customer</span>
      <span class="nb">name</span><span class="p">:</span> <span class="nb">name</span><span class="p">,</span>
      <span class="ss">email</span><span class="p">:</span> <span class="n">email</span>
    <span class="p">}</span>
    <span class="no">File</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">storage</span><span class="p">,</span> <span class="n">yaml</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">)</span> <span class="c1"># Saves the file with new data</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">load_yaml_storage</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>
  <span class="n">yaml</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span> <span class="c1"># Loads the yaml file</span>
  <span class="n">yaml</span> <span class="ow">or</span> <span class="p">{}</span>
<span class="k">rescue</span> <span class="no">Errno</span><span class="o">::</span><span class="no">ENOENT</span> <span class="c1"># If the file doesn&#39;t exists we return an empty hash</span>
  <span class="p">{}</span>
<span class="k">end</span>
</code></pre></div>
<h2>Add input fields to our task</h2>

<p>The example above is an working one so you can copy it and paste it into your
favorite editor and play along. To interact with the data before it&#39;s written to
the file we can use <code>STDIN</code> from ruby.</p>

<p>Lets try it by starting <code>irb</code> from the terminal and test the code below</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">value</span> <span class="o">=</span> <span class="no">STDIN</span><span class="o">.</span><span class="n">gets</span>
<span class="c1"># Ruby will now wait for you to write something and press enter, try with Hello, World!</span>

<span class="n">value</span><span class="o">.</span><span class="n">inspect</span>
<span class="c1"># =&gt; &quot;Hello, World!\n&quot;</span>
</code></pre></div>
<p>As you can se the value will also include an <code>\n</code> which we don&#39;t want. This can
be removed with</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">value</span><span class="o">.</span><span class="n">chomp</span>
<span class="c1"># =&gt; &quot;Hello, World!&quot;</span>
</code></pre></div>
<p>So if we take our new experience from this and add it to the Rakefile it could
look something like</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="c1"># Rakefile</span>
<span class="nb">require</span> <span class="s2">&quot;yaml&quot;</span>

<span class="n">namespace</span> <span class="ss">:customer</span> <span class="k">do</span>
  <span class="n">task</span> <span class="ss">:add</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">&quot;What&#39;s the customer name?&quot;</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="no">STDIN</span><span class="o">.</span><span class="n">gets</span><span class="o">.</span><span class="n">chomp</span>

    <span class="nb">puts</span> <span class="s2">&quot;And email?&quot;</span>
    <span class="n">email</span> <span class="o">=</span> <span class="no">STDIN</span><span class="o">.</span><span class="n">gets</span><span class="o">.</span><span class="n">chomp</span>

    <span class="n">storage</span> <span class="o">=</span> <span class="s1">&#39;customers.yml&#39;</span>
    <span class="n">yaml</span> <span class="o">=</span> <span class="n">load_yaml_storage</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>
    <span class="n">yaml</span><span class="o">[</span><span class="s2">&quot;customers&quot;</span><span class="o">]</span> <span class="o">||=</span> <span class="o">[]</span> <span class="c1"># Make sure the key customer is defined</span>
    <span class="n">yaml</span><span class="o">[</span><span class="s2">&quot;customers&quot;</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="p">{</span> <span class="c1"># Adds the new customer</span>
      <span class="nb">name</span><span class="p">:</span> <span class="nb">name</span><span class="p">,</span>
      <span class="ss">email</span><span class="p">:</span> <span class="n">email</span>
    <span class="p">}</span>
    <span class="no">File</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">storage</span><span class="p">,</span> <span class="n">yaml</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">)</span> <span class="c1"># Saves the file with new data</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">load_yaml_storage</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>
  <span class="n">yaml</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span> <span class="c1"># Loads the yaml file</span>
  <span class="n">yaml</span> <span class="ow">or</span> <span class="p">{}</span>
<span class="k">rescue</span> <span class="no">Errno</span><span class="o">::</span><span class="no">ENOENT</span> <span class="c1"># If the file doesn&#39;t exists we return an empty hash</span>
  <span class="p">{}</span>
<span class="k">end</span>
</code></pre></div>
<p>It should now be working. Lets try it out by running <code>rake customer:add</code> from
your terminal.</p>

<p><img src="/img/posts/2014-09-21/result.gif" alt="/img/posts/2014-09-21/result.gif"></p>

<p>Remember, you can add as many customers as you want. <code>STDIN</code> is pure ruby so
this example could be applied to other ruby scripts as well.</p>

  </article>

  <nav>
    
    <a rel="prev" class="a-hover"href="/pow/rbenv/2014/03/02/working-pow-setup.html">&lt; Get pow running with ZSH and Rbenv</a>
    
    
    <a rel="next" style="float:right" class="a-hover"href="/2014/09/28/fix-unable-to-start-the-phusion-passenger-watchdog.html">Fix: Unable to start the Phusion Passenger watchdog &gt;</i></a>
    
  </nav>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'aross-blogg'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
</main>


    <footer>
      <hr>

      <p>
        Alexander Ross
        <a href="mailto:alex+blogg@aross.se?subject=Hi, Alexander Ross">
          alex@aross.se
        </a>
      </p>

      <p>
        <a href="http://devb.io/ross">My <strong>CV</strong> at devb.io</a>
      </p>
    </footer>

    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-55009015-1', 'auto');
    ga('send', 'pageview');

    </script>
  </body>
</html>
