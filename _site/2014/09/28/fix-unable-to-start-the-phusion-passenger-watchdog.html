<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="author" href="/humans.txt">

    
      <title>Fix: Unable to start the Phusion Passenger watchdog - aross.se</title>
      <meta name="description" content="Does this look familiar for you? If it does, then you are on the right place.
" />
    

    <link href='//fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="/css/style.css">

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  </head>
  <body>
    <header>
      <!-- Top banner -->
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-4141599655973760"
           data-ad-slot="7238016739"
           data-ad-format="auto"></ins>
      <a href="/" title="aross.se" class="title">
        <span class="logo"></span>
        <span class="text">aross.se</span>
      </a>
      <p class="muted">Happy developer which loves to play around with Ruby, JavaScript and other stuff thats related to mobile and web development</p>
    </header>

    <main>
  <article>
    <h1>Fix: Unable to start the Phusion Passenger watchdog</h1>
    <small class="muted">28 September 2014</small>

    <p>Does this look familiar for you? If it does, then you are on the right place.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text"># /var/log/httpd/error_log
[Wed Sep 24 18:21:20 2014] [notice] caught SIGTERM, shutting down
[Wed Sep 24 18:21:20 2014] [notice] SELinux policy enabled; httpd running as context unconfined_u:system_r:httpd_t:s0
[Wed Sep 24 18:21:20 2014] [notice] suEXEC mechanism enabled (wrapper: /usr/sbin/suexec)
[Wed Sep 24 18:21:20 2014] [error] *** Passenger could not be initialized because of this error: Unable to start the Phusion Passenger watchdog (/usr/local/lib/ruby/gems/2.1.0/gems/passenger-4.0.52/buildout/agents/PassengerWatchdog): Permission denied (errno=13)
</code></pre></div>
<p>I did get this error while configured a new server with CentOS 6.5, Apache and
Passenger for an Ruby on Rails application. If your setup looks different, then
you may not be able to do exactly like me. I did google allot on <code>Unable
to start the Phusion Passenger watchdog</code> and <code>Permission denied (errno=13)</code> but
without success. I first thought it had something to do with file permissions
but it wasn&#39;t. The real problem here are SELinux security policy. We do not want
to turn this one of because it actually are trying to do good for us. After all
it&#39;s there for our security.</p>

<p>We need to know which services that is prevented in order to start passenger and
allow only those. To do that we start by setting SELinux into permissive mode.
This will allow us to run all application without it being stoped by SELinux use
but it will log warnings which we will use to create rule and permit what we need.</p>

<p>Open <code>/etc/selinux/config</code> and change <code>SELINUX=enforcing</code> to <code>SELINUX=permissive</code>.</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="c"># This file controls the state of SELinux on the system.</span>
<span class="c"># SELINUX= can take one of these three values:</span>
<span class="c">#   enforcing - SELinux security policy is enforced.</span>
<span class="c">#   permissive - SELinux prints warnings instead of enforcing.</span>
<span class="c">#   disabled - No SELinux policy is loaded.</span>
<span class="nv">SELINUX</span><span class="o">=</span>permissive
<span class="c"># SELINUXTYPE= can take one of these two values:</span>
<span class="c">#   targeted - Only targeted network daemons are protected.</span>
<span class="c">#   strict - Full SELinux protection.</span>
<span class="nv">SELINUXTYPE</span><span class="o">=</span>targeted
</code></pre></div>
<p>Now you need to reboot your server in order for these settings to take action.</p>

<p>Start the processes needed for your application to run (mysql, redis and so on)
and then visit your page in the browser. It should now be working because
everything is permitted but will create warnings.</p>

<p>Now we can create our rules by running the command bellow.</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">grep httpd_t /var/log/audit/audit.log <span class="p">|</span> audit2allow -m httpdrules &gt; httpdrules.te
</code></pre></div>
<p>You can now also run <code>cat httpdrules.te</code> and make sure it doesn&#39;t contain anything
suspicious. If it looks ok then we can make it permanent by running</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="c"># notice the capitalized -M instead of -m that we used before</span>
grep httpd_t /var/log/audit/audit.log <span class="p">|</span> audit2allow -M httpdrules
semodule -i httpdrules.pp
</code></pre></div>
<p>Next step to se if it all is working is to change <code>permissive</code> back to <code>enforcing</code>
in our <code>/etc/selinux/config</code> file and reboot.</p>

<h2>Q &amp; A</h2>

<dl>
<dt>It still doesn't work!</dt>
<dd>
If you get an similar error you can look at <a href="http://wiki.centos.org/HowTos/SELinux#head-aa437f65e1c7873cddbafd9e9a73bbf9d102c072">CentOS wiki</a>
how to customize these rules more. Else if you got another error this may just be one of a few errors in your stack. Google is your friend.
<dd>

<dt>How to install <code>audit2allow</code> if it's not available</dt>
<dd>
It comes with <code>policycoreutils-python</code> which is often installed with the system.
If this isn't on your system for any reason it can be installed with <code>yum install policycoreutils-python</code>.
</dd>

<dt>I don't use CentOS but i have the same error, will this work for me?</dt>
<dd>
This guide is written based on my experiences with CentOS, Apache, Passenger and
a Ruby on Rails application i tried to deploy. Some parts in this may still be
useful for you. But you will need to google a bit if your files don't look the same or if
they are not on the same location.
</dd>

<dt>I don't care about security, how to turn of SELinux completly?</dt>
<dd>
This is something you should only do if you not planing to go public with your
application. If this is true then just change your <code>SELINUX</code> option
in <code>/etc/selinux/config</code> to <code>disabled</code> and reboot.
</dd>
</dl>

  </article>

  <nav>
    
    <a rel="prev" class="a-hover"href="/2014/09/21/input-fields-in-rake-task.html"><i class="icon-arrow-left"></i> Input fields in rake task</a>
    
    
  </nav>
</main>


    <footer>
      <hr>

      <p>
        Alexander Ross
        <a href="mailto:alex+blogg@aross.se?subject=Hi, Alexander Ross">
          alex@aross.se
        </a>
      </p>

      <p>
        <a href="http://devb.io/ross">My <strong>CV</strong> at devb.io</a>
      </p>
    </footer>

    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-55009015-1', 'auto');
    ga('send', 'pageview');

    </script>
  </body>
</html>
