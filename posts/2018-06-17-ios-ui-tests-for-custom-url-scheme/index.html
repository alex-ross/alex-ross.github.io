<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Alexander Ross"/><link rel="canonical" href="https://aross.se/posts/2018-06-17-ios-ui-tests-for-custom-url-scheme"/><meta name="twitter:url" content="https://aross.se/posts/2018-06-17-ios-ui-tests-for-custom-url-scheme"/><meta name="og:url" content="https://aross.se/posts/2018-06-17-ios-ui-tests-for-custom-url-scheme"/><title>iOS UI tests for custom URL scheme | Alexander Ross</title><meta name="twitter:title" content="iOS UI tests for custom URL scheme | Alexander Ross"/><meta name="og:title" content="iOS UI tests for custom URL scheme | Alexander Ross"/><meta name="description" content="I like to build apps, websites, other tools and solutions to make the day more fun and efficient. I want to share as much as possible here as often as possible. But normaly I end up with a few posts per year right now. Work and family takes time as well üòá."/><meta name="twitter:description" content="I like to build apps, websites, other tools and solutions to make the day more fun and efficient. I want to share as much as possible here as often as possible. But normaly I end up with a few posts per year right now. Work and family takes time as well üòá."/><meta name="og:description" content="I like to build apps, websites, other tools and solutions to make the day more fun and efficient. I want to share as much as possible here as often as possible. But normaly I end up with a few posts per year right now. Work and family takes time as well üòá."/><meta name="twitter:card" content="summary"/><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-55009015-1', 'auto');
ga('send', 'pageview');</script><script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" data-ad-client="ca-pub-4141599655973760"></script><link rel="stylesheet" href="/styles.css?v=5" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/ArossWebsite/favicon-96x96.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Alexander Ross"/><meta name="twitter:image" content="https://aross.se/ArossWebsite/logo.png"/><meta name="og:image" content="https://aross.se/ArossWebsite/logo.png"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">Alexander Ross</a></div></header><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4141599655973760" data-ad-slot="7238016739" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script><div class="wrapper"><article><p>‚è± around 5 minutes read time</p><span>Tagged with: </span><ul class="tag-list"><li><a href="/tags/ios">ios</a></li><li><a href="/tags/development">development</a></li><li><a href="/tags/custom-url-scheme">custom url scheme</a></li></ul><div class="content"><h1>iOS UI tests for custom URL scheme</h1><p>UI tests is a great way to test that your application behaves as you expect it to and also to verify that you don't break any features in the future. If you are used to write unit tests you may also be used to write your code using dependency injections or to mock and stub dependencies. In UI tests however, you don't have access to your code and to simulate a user as close as possible you will probably write your tests and interact with other services just as a regular user. Then you can be quite sure that your app is working as it should.</p><p>In this post I will go through how to write UI tests for a custom URL scheme in iOS. If you haven't read or need to know how to implement custom URL scheme you can take another look at my blog post "<a href="/posts/2018-05-21-implement-custom-url-scheme-in-ios/">Implement custom URL scheme in iOS</a>". I will continue with the source code created using that blog post. So if you would like to test it yourself you can go back and implement it or download the source code by the link below.</p><p><a href="https://github.com/alex-ross/URLViewer/archive/1.zip">Download source code</a>.</p><h2>Create a UI Test target</h2><p>We need a UI test target to run UI tests on the simulator or our development device. So lets create one first.</p><p>Go to the "test navigator", see the image below.</p><img src="/images/posts/2018-06-17/show-test-navigator.png"/><p>Then at the bottom left corner you will find a "+" button, click on that one and then on "New UI Test Target..."</p><img src="/images/posts/2018-06-17/add-ui-test-target-1.png"/><p>You will probably have everything pre filled now, but make sure that the project is the same as the current one and that "target to test" is the actually iOS application that you are testing.</p><img src="/images/posts/2018-06-17/add-ui-test-target-2.png"/><p>Click "Finish" and your test target should now be created. It will also create a test file that you can open, it will be named "URLViewerUITests.swift".</p><h2>Write the tests</h2><p>Usually I start to remove all comments in the generated files because it just creates a lot of noise. You can also remove the <code>tearDown</code>, we will not use that right now. Finally I also like to have a variable called <code>app</code> for the application itself. So lets add that one and set it up in the <code>setUp</code> method. You should end up with something similar to the code below. Feel free to copy that one if you need.</p><pre data-language="swift"><code><span class="hljs-keyword">import</span> XCTest

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">URLViewerUITests</span>: <span class="hljs-title">XCTestCase</span> </span>{
    <span class="hljs-keyword">var</span> app: <span class="hljs-type">XCUIApplication!</span>

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.setUp()
        continueAfterFailure = <span class="hljs-literal">false</span>
        app = <span class="hljs-type">XCUIApplication</span>()
        app.launch()
    }

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testExample</span><span class="hljs-params">()</span></span> {
    }
}
</code></pre><p>You can run all tests using <code>‚åò</code>+<code>u</code>. It should open the application in the simulator and then tell you that all tests passes because we don't assert anything right now.</p><p>In our first test we would like to test that the application launches as usual and that it has the correct default text. This is a simple test and should look like this.</p><pre data-language="swift"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testDefaultLabelWhenOpenApp</span><span class="hljs-params">()</span></span> {
    <span class="hljs-type">XCTAssert</span>(app.staticTexts[<span class="hljs-string">"Label"</span>].exists)
}
</code></pre><p>It will basically check that we have the static text "Label" in our application which we should have because it's the default text we did set to the label. So if that will change anytime, the test will fail. If you run the tests using</p><p><code>‚åò</code>+<code>u</code> again it should still pass. But try to change the text to something else and you will see that it will not pass any more.</p><p>But we would also like to test that the application changes the URL to the one that it was opened with. We do know that we can use Safari in the simulator simulate that the application was opened using an URL. We can automate other applications in the UI tests as well and use Accessibility Inspector to find the identifiers for the components we would like to tap or interact with.</p><p>Use Xcode meny bar and open Accessibility Inspector. You will find it at <strong>Xcode</strong> ‚Ä£ <strong>Open Developer Tools</strong> ‚Ä£ <strong>Accessibility Inspector</strong>.</p><img src="/images/posts/2018-06-17/accessibility-inspector-open.png"/><p>Then you can activate the inspection by tapping the button in the circle at the image below. You will se that the pointer is at the address bar and it will tell you that the address bar component has the identifier "URL". We can use that to target the component and tap it.</p><img src="/images/posts/2018-06-17/accessibility-inspector-inspect.png"/><p>Se the complete test below.</p><pre data-language="swift"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testLabelTextWhenOpenedByURL</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// Get the safari app using its bundle identifier</span>
    <span class="hljs-keyword">let</span> safari = <span class="hljs-type">XCUIApplication</span>(bundleIdentifier: <span class="hljs-string">"com.apple.mobilesafari"</span>)
    <span class="hljs-comment">// Launch safari</span>
    safari.launch()
    <span class="hljs-comment">// Ensure that safari is running in foreground before we continue</span>
    <span class="hljs-number">_</span> = safari.wait(<span class="hljs-keyword">for</span>: .runningForeground, timeout: <span class="hljs-number">30</span>)

    <span class="hljs-comment">// Access the address bar component and tap it</span>
    safari.buttons[<span class="hljs-string">"URL"</span>].tap()
    <span class="hljs-comment">// You will now have a cursor in the address field. So lets type in the text for our URL</span>
    safari.typeText(<span class="hljs-string">"urlviewer://example"</span>)
    <span class="hljs-comment">// Make a new line character to simulate that the user taps the return key</span>
    safari.typeText(<span class="hljs-string">"\n"</span>)
    <span class="hljs-comment">// An pop-up will open and ask you to launch the application. Tap it's "Open" button to confirm</span>
    safari.buttons[<span class="hljs-string">"Open"</span>].tap()

    <span class="hljs-comment">// Wait for your application to be the one in foreground</span>
    <span class="hljs-number">_</span> = app.wait(<span class="hljs-keyword">for</span>: .runningForeground, timeout: <span class="hljs-number">5</span>)

    <span class="hljs-comment">// Now we can assert that we do display the URL in our application</span>
    <span class="hljs-type">XCTAssert</span>(app.staticTexts[<span class="hljs-string">"urlviewer://example"</span>].exists)
}
</code></pre><p>Run the test again and make sure it still passes.</p></div><span>Tagged with: </span><ul class="tag-list"><li><a href="/tags/ios">ios</a></li><li><a href="/tags/development">development</a></li><li><a href="/tags/custom-url-scheme">custom url scheme</a></li></ul></article></div><footer><p><a href="https://standout.se">Work with me</a></p><p><a href="/feed.rss">RSS feed</a></p><p><a href="https://github.com/JohnSundell/Publish">This is a static website built with Publish</a></p></footer></body></html>